<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5.2. Free store pointers &#8212; Intermediate Modern C++ Overview</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/clickable.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/fitb.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/modal-basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/datafile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/showEval.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dragndrop.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../_static/runestone-custom-sphinx-bootstrap.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/clickable.js"></script>
    <script type="text/javascript" src="../_static/timedclickable.js"></script>
    <script type="text/javascript" src="../_static/tabbedstuff.js"></script>
    <script type="text/javascript" src="../_static/fitb.js"></script>
    <script type="text/javascript" src="../_static/timedfitb.js"></script>
    <script type="text/javascript" src="../_static/reveal.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/hammer.min.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/timedparsons.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js"></script>
    <script type="text/javascript" src="../_static/timedmc.js"></script>
    <script type="text/javascript" src="../_static/timed.js"></script>
    <script type="text/javascript" src="../_static/shortanswer.js"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js"></script>
    <script type="text/javascript" src="../_static/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/pytutor.js"></script>
    <script type="text/javascript" src="../_static/codelens.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/xml.js"></script>
    <script type="text/javascript" src="../_static/css.js"></script>
    <script type="text/javascript" src="../_static/htmlmixed.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/javascript.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/clike.js"></script>
    <script type="text/javascript" src="../_static/timed_activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/datafile.js"></script>
    <script type="text/javascript" src="../_static/showEval.js"></script>
    <script type="text/javascript" src="../_static/dragndrop.js"></script>
    <script type="text/javascript" src="../_static/timeddnd.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.3. Pointer debugging" href="valgrind.html" />
    <link rel="prev" title="5.1. Pointers" href="pointers.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<link rel="shortcut icon" href="/intermediate-cpp/static/favicon.ico" type="image/ico" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'https://daveparillo.github.io/intermediate-cpp/' ? 'https://daveparillo.github.io/intermediate-cpp/' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/intermediate-cpp';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'intermediate-cpp';
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'cpp'
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = false;
  eBookConfig.python3 = false;
  eBookConfig.basecourse = 'intermediate-cpp';
  eBookConfig.jobehost = 'https://cryptic-headland-94862.herokuapp.com/http://jobe2.cosc.canterbury.ac.nz';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.runestone_version = '3.0.7';
</script>


  </head>
  <body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        <a class="brand-logo" style='padding:12px 0;text-align:center' href="http://209.129.16.61/~dparillo/">
           <i class="glyphicon glyphicon-home" style='opacity:0.9;font-size:16px;color:#848484'></i>
        </a>
        <!--
        <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;' href="/intermediate-cpp/default/user/login">&nbsp; </a>
        <a class="navbar-brand" href="/~dparillo" style="color:#5080a0">CISC-187</a>&nbsp;
        -->
        <a class="navbar-brand" href="../index.html">Intermediate C++</a>
      </div>
    </div>

    <div class="navbar-collapse collapse navbar-ex1-collapse">

      <ul class="nav navbar-nav navbar-right">

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html'>Table of Contents</a></li>
            
            <li><a href='https://daveparillo.github.io/intermediate-cpp//genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        
        <li class="divider-vertical"></li>

        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='https://daveparillo.github.io/intermediate-cpp//help/navhelp.html'>Navigation Help</a></li>
            <li><a href='https://daveparillo.github.io/intermediate-cpp//glossary.html'>Glossary</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>

      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        <!--
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">5.2. Free store pointers</a><ul>
<li><a class="reference internal" href="#stl-memory-management">5.2.1. STL memory management</a><ul>
<li><a class="reference internal" href="#class-std-unique-ptr">5.2.1.1. Class <code class="docutils literal"><span class="pre">std::unique_ptr</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - 5.1. Pointers" data-toggle="tooltip">
    <a href="pointers.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - 5.3. Pointer debugging' data-toggle="tooltip" >
    <a href="valgrind.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content">
  
  <div class="section" id="free-store-pointers">
<span id="index-0"></span><h1>5.2. Free store pointers<a class="headerlink" href="#free-store-pointers" title="Permalink to this headline">¶</a></h1>
<p>So far, all of our variables have been created on the <a class="reference internal" href="../glossary.html#term-stack"><span class="xref std std-term">stack</span></a>.
Another way to say this is our variables have <em>automatic storage duration</em>.
Variables exist only as long as the scope in which they were created.
Sometimes, we need to create objects with dynamic storage duration,
that is, objects whose lifetime is not limited by the scope in which they were created.</p>
<p>One way to do this is to use the <code class="docutils literal"><span class="pre">new</span></code> keyword to create objects on the <a class="reference internal" href="../glossary.html#term-free-store"><span class="xref std std-term">free store</span></a>.
The free store is a system-provided memory pool for variables whose lifetime is
directly managed by the programmer.
Compare to our experiences so far where variables were <em>automatically</em>
managed by the system, not by the programmer.</p>
<p>The new operator takes a type and (optionally) a set of initializers for that type as its arguments.
It returns a pointer to an (optionally) initialized object of its type:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
     <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// member values is a C++11 feature</span>
     <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>     <span class="c1">// allocate 1 uninitialized int</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>  <span class="c1">// allocate 3 uninitialized ints</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>  <span class="c1">// allocate 1 int initialized to 5</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p4</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>  <span class="c1">// allocate 1 int initialized to 5, C++11 or later</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p5</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">();</span>   <span class="c1">// allocate 1 int initialized to 0</span>

  <span class="n">Point</span><span class="o">*</span> <span class="n">pt1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>          <span class="c1">// allocate a default constructed Point</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">pt2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">();</span>        <span class="c1">// allocate a default constructed Point</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">pt3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>       <span class="c1">// allocate 3 default constructed Points</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Step though</dt>
<dd><a class="reference external" href="http://pythontutor.com/cpp.html#code=struct%20Point%20%7B%0A%20%20double%20x%20%3D%200%3B%20%20//%20member%20values%20is%20a%20C%2B%2B11%20feature%0A%20%20double%20y%20%3D%200%3B%0A%7D%3B%0A%0Aint%20main%28%29%20%7B%0A%20int*%20p1%20%3D%20new%20int%3B%20%20%20%20%20//%20allocate%201%20uninitialized%20int%0A%20int*%20p2%20%3D%20new%20int%5B3%5D%3B%20%20//%20allocate%203%20uninitialized%20ints%0A%20int*%20p3%20%3D%20new%20int%285%29%3B%20%20//%20allocate%201%20int%20initialized%20to%205%0A%20int*%20p4%20%3D%20new%20int%7B5%7D%3B%20%20//%20allocate%201%20int%20initialized%20to%205,%20C%2B%2B11%20or%20later%0A%20int*%20p5%20%3D%20new%20int%28%29%3B%20%20%20//%20allocate%201%20int%20initialized%20to%200%0A%0A%20Point*%20pt1%20%3D%20new%20Point%3B%20%20%20%20%20%20%20%20%20%20//%20allocate%20a%20default%20constructed%20Point%20%0A%20Point*%20pt2%20%3D%20new%20Point%28%29%3B%20%20%20%20%20%20%20%20//%20allocate%20a%20default%20constructed%20Point%20%0A%20Point*%20pt3%20%3D%20new%20Point%5B3%5D%3B%20%20%20%20%20%20%20//%20allocate%203%20default%20constructed%20Points%0A%7D&amp;mode=display&amp;origin=opt-frontend.js&amp;py=cpp&amp;rawInputLstJSON=%5B%5D">example 1 here</a></dd>
</dl>
<p>In all of the above cases,
since the <code class="docutils literal"><span class="pre">new</span></code> operator returns a pointer to an object of its type,
the initialization could use <code class="docutils literal"><span class="pre">auto</span></code>.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">auto</span> <span class="n">pt1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">new</span></code> operator allocates memory.
When finished with the free-store memory,
we return it to the pool of available memory using
the <code class="docutils literal"><span class="pre">delete</span></code> operator:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
     <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// member values is a C++11 feature</span>
     <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

  <span class="n">Point</span><span class="o">*</span> <span class="n">pt_x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">;</span>
  <span class="n">Point</span><span class="o">*</span> <span class="n">points</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

  <span class="k">delete</span>   <span class="n">p1</span><span class="p">;</span>  <span class="c1">// free memory allocated for a single object</span>
  <span class="k">delete</span><span class="p">[]</span> <span class="n">p2</span><span class="p">;</span>  <span class="c1">// free array memory</span>

  <span class="k">delete</span>   <span class="n">pt_x</span><span class="p">;</span>  <span class="c1">// same syntax is used for user defined types also</span>
  <span class="k">delete</span><span class="p">[]</span> <span class="n">points</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There should always be exactly 1 <code class="docutils literal"><span class="pre">delete</span></code> for every pointer returned by <code class="docutils literal"><span class="pre">new</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There are two forms of <code class="docutils literal"><span class="pre">delete</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">delete</span> <span class="pre">p</span></code> frees the memory for a single object allocated using <code class="docutils literal"><span class="pre">new</span></code></li>
<li><code class="docutils literal"><span class="pre">delete[]</span> <span class="pre">p</span></code> frees the memory for an array of objects allocated using <code class="docutils literal"><span class="pre">new</span></code></li>
</ul>
<p class="last">Mistakes over which version of delete to use is a common source of error.</p>
</div>
<p>Other mistakes related to delete include deleting the same pointer twice,
or not deleting the pointer at all.</p>
<p>Deleting the same pointer twice is a problem because it leads to undefined
or unpredictable behavior.
The problem rarely arises in very small or short programs,
however, in larger programs, strange or unpredictable events may happen
long after the code that actually does the double delete was written.
Programs that free memory twice have created real-world
<a class="reference external" href="http://www.kb.cert.org/vuls/id/650937">security vulnerabilities</a>.</p>
<p>Simply choosing to never delete a pointer on the theory that
“well, at least my program won’t crash”, is not a good idea either.
All computers have a finite amount of memory.
Depending on how long your program needs to run,
never returning unused memory back to the memory <em>pool</em> is
referred to as a <a class="reference internal" href="../glossary.html#term-memory-leak"><span class="xref std std-term">memory leak</span></a>.
Also recall computer are <em>fast</em>.
Depending on what your program does,
even a short program can run out of memory before accomplishing all of its goals.</p>
<div class="section" id="stl-memory-management">
<span id="index-1"></span><h2>5.2.1. STL memory management<a class="headerlink" href="#stl-memory-management" title="Permalink to this headline">¶</a></h2>
<p>When memory is allocated using <code class="docutils literal"><span class="pre">new</span></code>,
eventually it must be recovered using <code class="docutils literal"><span class="pre">delete</span></code>.
When only a few lines of code are requesting memory,
this is not a major problem.
However, real world programs often request hundreds or thousands
blocks of memory.
Keeping track of all this memory and when it should be freed can be labor intensive.
Moreover, the consequences of an error are high: program crash or corrupted data.</p>
<p>Given that memory management is such a problem,
does the STL provide any resources to help solve it?</p>
<p>Yes.</p>
<p>The C++ Standard Template Library provides a family of classes to help solve these problems.
They are all contained in the header <code class="docutils literal"><span class="pre">&lt;memory&gt;</span></code>
and are defined as templates so that they can point to objects of any type.</p>
<p>Smart pointers are classes that behave like <em>raw</em> pointers but also manage objects
created with <code class="docutils literal"><span class="pre">new</span></code>,
so that you don’t have to worry about when and whether to delete them.
Smart pointers are declared on the <a class="reference internal" href="../glossary.html#term-stack"><span class="xref std std-term">stack</span></a> and
automatically delete the encapsulated object when the smart pointer goes out of scope.
The smart pointer is defined in such a way that it can be used
syntactically almost exactly like a raw pointer.</p>
<p>One of the earliest so-called ‘smart pointers’ was <code class="docutils literal"><span class="pre">auto_ptr</span></code>.
Much online documentation and text books still refer to it and recommend it.
auto-ptr was officially deprecated in C++11 and removed in C++17.
Generally, where old texts refer to auto_ptr, use <code class="docutils literal"><span class="pre">unique_ptr</span></code> instead.</p>
<div class="section" id="class-std-unique-ptr">
<h3>5.2.1.1. Class <code class="docutils literal"><span class="pre">std::unique_ptr</span></code><a class="headerlink" href="#class-std-unique-ptr" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal"><span class="pre">std::unique_ptr</span></code> is a smart pointer that owns and manages another object through a pointer
and disposes of that object when the unique_ptr goes out of scope.
A unique_ptr is a very lightweight wrapper around a pointer.
The basic syntax is:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// older C++11 syntax</span>
<span class="c1">// clunky and repetitive</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>       <span class="c1">// C++14 adds make_unique</span>
</pre></div>
</div>
<p>In each example, both <code class="docutils literal"><span class="pre">p1</span></code> and <code class="docutils literal"><span class="pre">p2</span></code> are unique pointers that ‘own’ an <code class="docutils literal"><span class="pre">int*</span></code>.
Our earlier examples can be changed to:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;memory&gt;</span>
<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">auto</span>                 <span class="n">p3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>       <span class="c1">// less redundant</span>

  <span class="c1">// array examples</span>
  <span class="c1">// unique pointers to arrays of 5 elements</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
  <span class="k">auto</span>                   <span class="n">p5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

  <span class="c1">// user define types are no different</span>
  <span class="k">auto</span> <span class="n">pt_x</span>   <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>    <span class="c1">// one Point*</span>
  <span class="k">auto</span> <span class="n">points</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// array of 3 Point*</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once declared, a unique pointer can be manipulated using the same syntax as a raw pointer.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>
<span class="c1">// modify Point coordinates and print</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="c1">// this is an error</span>
<span class="c1">// std::cout &lt;&lt; p.x &lt;&lt; &#39; &#39; &lt;&lt; p.y &lt;&lt; &#39;\n&#39;;</span>
</pre></div>
</div>
<p>What makes a unique_ptr <em>unique</em>?</p>
<p>An object stored within a unique pointer <strong>uniquely owns</strong> its pointer.
In other words, an object is ‘owned’ by exactly one unique_ptr.
Unlike raw pointers, a unique pointer cannot be copied or assigned to another variable,
even another unique pointer.</p>
<p>No two unique pointers can ever contain the same raw pointer value.
This solves the ‘double delete’ problem if both go out of scope.
The result is that some operations you <strong>can</strong> perform on raw pointers are not allowed:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">auto</span> <span class="n">x</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">};</span>     <span class="c1">// error - copy construction not allowed</span>

<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">z</span><span class="p">;</span>           <span class="c1">// new empty (nullptr)</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">z</span><span class="p">)</span> <span class="p">{</span>                            <span class="c1">// check if z != nullptr</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>                            <span class="c1">// error - copy assignment not allowed</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="first admonition-title">More to Explore</p>
<ul class="last simple">
<li><a class="reference external" href="https://isocpp.org/wiki/faq/freestore-mgmt">Free-store managment FAQ</a></li>
<li>From: cppreference.com:<ul>
<li><a class="reference external" href="http://en.cppreference.com/w/cpp/language/new">Operator new</a> and
<a class="reference external" href="http://en.cppreference.com/w/cpp/language/delete">delete</a>.</li>
<li><a class="reference external" href="http://en.cppreference.com/w/cpp/memory/unique_ptr">unique_ptr</a> and
<a class="reference external" href="http://en.cppreference.com/w/cpp/memory/unique_ptr/make_unique">make_unique</a>.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>


  
      
  <li id="relations-prev" class="navLink" title='Previous Section - 5.1. Pointers' data-toggle="tooltip">
    <a href="pointers.html" >
      <i class='prevNav glyphicon glyphicon-chevron-left'></i>
    </a>
  </li>
  <a class="navLinkBg" id="navLinkBgLeft"  href="pointers.html" ></a>
  
  <li id="relations-next" class="navLink" title='Next Section - 5.3. Pointer debugging' data-toggle="tooltip" >
    <a href="valgrind.html" >
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right'></i>
    </a>
  </li>
  <a class="navLinkBg navLink" id="navLinkBgRight" href="valgrind.html" >Next Section - 5.3. Pointer debugging</a>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});
  
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2018 Dave Parillo.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> 3.0.7.
    </p>
  </div>
</footer>



  </body>
</html>